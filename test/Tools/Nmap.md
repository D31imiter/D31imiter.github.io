#### 主机发现

1. -sn：Ping扫描-禁用端口扫描
2. -sL：仅仅列出指定网络上的每台主机， 不发送任何报文到目标主机，会报告IP地址的总数，不进行ping和端口扫描
3. -sP：仅仅进行ping扫描 (主机发现)，然后打印出对扫描做出响应的那些主机，不进行端口扫描
4. -P0：无ping扫描，和列表扫描一样，跳过正常的主机发现，但是会按照你的具体要求一个个进行端口扫描，版本探测，或者操作系统探测，就好像每个IP都是活动的
5. -PE;-PP;-PM： Nmap可以发送ping 程序所发送的报文，也能发送ICMP回声请求，使用-PE打开该回声请求功能，也可以使用-PP打开该回声请求功能，-MP打开地址掩码请求，当管理员封锁了ICMP回声请求而忘了其它ICMP查询可能用于 相同目的时，这两个查询可能很有价值

   ```
   关于nmap内网主机嗅探而扫描出所整个c段地址：

   nmap认为主机存活只需满足四个条件之一：
   ICMP echo request
   TCP SYN to port 443
   TCP ACK to port 80
   ICMP timestamp request

   Linux下默认Ping命令使用的ICMP echo请求，现在Ping不通，那第一种请求是没有主机存活特征的，问题可能在后面的三种请求。
   通过抓包分析，ICMP echo请求和ICMP timestamp请求都没有响应，但收到80端口的ACK请求，有一个RST标志的响应，就是这个包导致了nmap误判。网络中再没有其他网络设备，这个包就是VMware的NAT返回的。

   可以通过加上—PE参数，仅以ICMP回声作为判断标准即可避免此异常
   ```

#### 端口扫描

端口状态：

- open：开放
- closed：关闭
- filterd：处于过滤状态无法收到返回的probe状态
- unfiltered：收到返回的probe，无法确认
- 1/2：两种窗台状态共存

1. -sS：TCP SYN扫描，发送一个SYN报文，执行迅速，不建立完整的TCP连接，不容易被探测，明确区分端口状态
2. -sT：通过创建connect()系统调用要求操作系统和目标机以及端口建立连接，而不像其它扫描类型直接发送原始报文，相比于SYN扫描这种直接发送报文的扫描，connect()对原始报文的控制更少，效率更低。且connect()系统调用完全连接到开放的目标端口而不是像SYN扫描进行 半开放的复位，需要花费更多时间，更多报文得到同样的信息，目标机也更可能记录下连接，扫描被防火墙拦截。
3. -sU：UDP扫描（较慢），可以使用-sT或-sS同时检查两种协议，可以使用-sV区分真正开放和被过滤的端口

#### 端口服务版本探测

1. -p：扫描指定的端口，例如参数 `-p U:53，111，137，T:21-25，80，139，8080`，像这样的扫描需要加上UDP扫描-sU和至少一个TCP扫描-sT。如果没有给定协议限定符， 端口号会被加到所有协议列表。
2. -sV：打开版本探测，确定正在运行的服务
3. -O：启用操作系统检测
4. -A：侵略性探测，返回服务器的操作系统等主机服务信息

#### misc

1. --dns-servers dns域名解析服务器：该参数指定dns服务器用来解析
2. -exclude ip :扫描除某一个ip外的所有子网主机
3. -Pn：不知道主机是否存活或防火墙是否开启的机器，该参数停止探测前ICMP请求，不触发防火墙安全机制
4. -v | -vv：持续输入返回的数据，显示进度
5. -T[0-5]：指定扫描速度，参数越小越不容易被检测到，参数越大扫描速度越快，越容易被检测到

#### 扫描流程

1. 主机发现：`nmap -sn -PE -n [ip]`
2. 初步端口扫描：`nmap -sT --min-rate=10000 -p- [ip]`
3. UDP扫描：`nmap -sU -p- [ip]`
4. 详细版本探测：`nmap -sT -sV -O -A -p[ports] [ip]`
5. 漏洞脚本扫描：`nmap --script=vuln -p[ports] [ip]`
