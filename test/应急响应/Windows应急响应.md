### 常见应急响应分类

* Web入侵：攻击者取得webshell权限，网页挂马，主页篡改，Webshell后门
* 系统入侵：攻击者取得初级用户权限，

### 排查思路

#### Web层面

1. 使用河马，D盾等工具查杀对方遗留的网站后门文件，一般后门文件都做过免杀，手动比工具往往更有效
2. 查看流量监控，IDS，是否有可疑的请求，短时间内同一个IP发送了大量数据包
3. Web日志分析，可以使用日志分析工具，例如，360星图，LogForensics，AWStats等
4. 相关后门文件查杀完成后进行网站漏洞分析，利用漏洞扫描工具，vulmap，Nikto，WebScarab等，找出Web漏洞
5. 尽快修复Web漏洞，同时修改数据库等密码，攻击者可能通过读取配置文件已活得相关密码

#### 系统用户层面

1. 查看开机启动文件：
   * 利用操作系统中启动菜单
   * 利用系统配置msconfig，打开任务管理器查看
   * 利用注册表regedit，路径：`计算机\HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run\LenovoDisabled`
2. 查看temp临时文件，一般的后门文件都存放于此，通常Guest用户具有此文件夹下的读写执行权限，最有可能遗留后门的目录
   * 查看是否有PE文件（exe、dll、sys），或者特别大的tmp文件
   * 上传沙盒看看是否是恶意代码
3. 查看浏览器的历史纪录，查看储存的cookie
4. 文件分析，根据更改时间，靠前的一般为可疑的后门文件，但菜刀等工具也可修改时间来迷惑
5. 进程分析，可疑进程发现与关闭：`netstat -ano`，查看开放端口，`tasklist`查看进程，`taskkill /PID值`终止进程
6. windows计划任务，`schtasks`查看计划任务
7. 查看最近打开的文件，`C:/Documents and Settings/Administrator/Recent`下查看
8. 查看用户，细分为以下：
   1. 创建的隐藏账户,$用户，对 `net user`命令隐藏：
   2. 创建的隐藏账户可以在用户账户中看到，进一步隐藏，编辑注册表，将管理员权限的RID（注册表中的f值）复制给影子账户
   3. 先将刚刚编辑的注册表导出，然后删除，在命令行中执行 `net user /del shadow$`
   4. 再次将注册表中的内容导入，此时在用户组中查看不到账户，在注册表中，如果是非管理员权限的用户依旧无法看到存在于SAM注册表中的隐藏账户
